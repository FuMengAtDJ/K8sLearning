## 模块8作业说明

#### 1.  修改代码
   ```
    ① 为体现代码和配置分离，修改部分代码，从ConfigMap中获取环境变量。
   ```
   ```
    ② 设置glog，依据日志等级处理log，并修改log文件最大为10M。
   ```
   ```
    ③ 修改Makefile的版本号至v1.5, make release, make push发布新版本
   ```
#### 2.  yaml文件作成
   ```
    参照/k8s目录
    httpserver-deployment.yaml
    httpserver-service.yaml
    configmap.yaml
    secret.yaml
   ```
#### 3.  集群操作
   ```
    k apply -f secret.yaml
    k apply -f configmap.yaml
    k apply -f httpserver-deployment.yaml // 具体看注释部分。
    k apply -f httpserver-service.yaml
   ```
   ```
    //创建结果确认 
    cadmin@k8snode:~/K8sLearning/httpserver/k8s$ kg deployment
    NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
    httpserver-deployment   3/3     3            3           41m
    cadmin@k8snode:~/K8sLearning/httpserver/k8s$ kg po
    NAME                                     READY   STATUS    RESTARTS   AGE
    httpserver-deployment-668499b7cd-9gpkx   1/1     Running   0          22m
    httpserver-deployment-668499b7cd-v7hgg   1/1     Running   0          22m
    httpserver-deployment-668499b7cd-ztqr5   1/1     Running   0          22m
    cadmin@k8snode:~/K8sLearning/httpserver/k8s$ kg svc
    NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
    httpserver-service   ClusterIP   10.96.170.18   <none>        80/TCP    3d21h
   ```
   ```
    // 动作确认
    cadmin@k8snode:~/K8sLearning/httpserver/k8s$ curl 10.96.170.18
    Hello, Welcome to kubernetes.
   ```
   ```
    // 探活
    cadmin@k8snode:/var/log/containers$ curl http://10.96.170.18/healthz
    200
   ```
   ```
    // 查看日志
    cadmin@k8snode:~/K8sLearning/httpserver/k8s$ k logs httpserver-deployment-668499b7cd-9gpkx
    I1123 13:19:02.422463       7 httpserver.go:25] Starting http server...
    I1123 13:22:55.182367       7 httpserver.go:43] entering root handler
    I1123 13:22:55.182445       7 httpserver.go:59] [time: 2021-11-23 13:22:55]-host: 10.0.2.15:53078-method: GET-code: 200
   ```